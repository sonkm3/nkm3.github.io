<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    pelican plugin to embed sourcecode from github
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <meta property="og:site_name" content="nkm3" />
                <meta property="og:type" content="article" />
                <meta property="og:title" content="pelican plugin to embed sourcecode from github" />
                <meta property="og:url" content="https://nkm3.org/pelican-plugin-to-embed-sourceccode-from-github.html" />
                <meta property="og:description" content="pelicanのページにgithubのソースコードを埋め込めるようにしてみた" />
                    <meta property="article:tag" content="note" />
                    <meta property="article:tag" content="software" />
            <link rel="stylesheet" href="https://nkm3.org/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://nkm3.org/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://nkm3.org/theme/css/main.css">

    <link rel="stylesheet" href="https://nkm3.org/theme/css/blog.css">
    <link rel="stylesheet" href="https://nkm3.org/theme/css/github.css">
        <link href="https://nkm3.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="nkm3 Atom Feed" />
        <script src="https://nkm3.org/theme/js/vendor/modernizr-2.6.2.min.js"></script>
        <meta name="google-site-verification" content="DpqlLQbMCcABYeNKp2A06sMQTxLp3Cjn0E4JdR3wLGA" />
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href="https://nkm3.org"><h1><i class="icon-double-angle-right"></i> nkm3</h1></a>
        <p id="site-desc"></p>
    </hgroup>
    <nav>
        <ul id="nav-links">
                <li><a href="https://nkm3.org//pages/about.html">About</a></li>
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2021-08-21T00:00:00+09:00" pubdate>
                            Sat 21 August 2021
                        </time>
                        <a href="https://nkm3.org/pelican-plugin-to-embed-sourceccode-from-github.html" rel="bookmark"><h1>pelican plugin to embed sourcecode from github</h1></a>
                    </header>

                    <section class="post-content">
                        <h2>pelicanのページにgithubのソースコードを埋め込めるようにしてみた</h2>
<p>ソースコードの埋め込み表示にはEmbed Like Gistを使って、jsへ値を渡すためのMarkdownエクステンションをmdx_embedlyを元にして書いた感じ  </p>
<h3>さっそく埋め込んでみる</h3>
<p>埋め込みたいところで[https://github.com/{user}/{repo}/blob/main/{path-to-file}:embed-github]と書くと以下のようにソースコードが埋め込まれる<br>
実際のエクステンションのソースも動作もこれだけ、というかそれだけ、という感じ</p>
<p><script src="/javascripts/embed.js?target=https%3A%2F%2Fgithub.com%2Fsonkm3%2Fsonkm3.github.io%2Fblob%2Fmain%2Fplugins%2Fembed_github.py&style=github&showBorder=on&showLineNumbers=on&showFileMeta=on"></script></p>
<h3>行番号で範囲指定もできる</h3>
<p>例えばこんな感じに書くと [\https://github.com/sonkm3/sonkm3.github.io/blob/main/plugins/embed_github.py#L8-L11:embed-github] 下のように表示される(<code>\</code>は消してねおねがい)</p>
<p><script src="/javascripts/embed.js?target=https%3A%2F%2Fgithub.com%2Fsonkm3%2Fsonkm3.github.io%2Fblob%2Fmain%2Fplugins%2Fembed_github.py%23L8-L11&style=github&showBorder=on&showLineNumbers=on&showFileMeta=on"></script></p>
<h3>おまけ:MarkdownモジュールはEmbedGithubExtensionを自動で使えるようにしてくれない</h3>
<p><code>pelican.conf</code>の<code>MARKDOWN</code>に<code>'plugins.embed_github:EmbedGithubExtension': {},</code>のように追加すると使えるようになる<br>
例えばこんな感じ<br>
以前の<code>Pelican</code>と書き方が変わったのかな？使っているのは<code>Pelican 4.6</code>です  </p>
<div class="highlight"><pre><span></span><code>MARKDOWN = {
    &#39;extension_configs&#39;: {
        &#39;markdown.extensions.codehilite&#39;: {&#39;css_class&#39;: &#39;highlight&#39;},
        &#39;markdown.extensions.extra&#39;: {},
        &#39;markdown.extensions.meta&#39;: {},
        &#39;plugins.embed_github:EmbedGithubExtension&#39;: {},
    },
    &#39;output_format&#39;: &#39;html5&#39;,
}
</code></pre></div>

<h3>おまけ:Markdownエクステンションの動作確認</h3>
<p>Markdownのエクステンションを書く時はPelicanからではなくmarkdownモジュールを直接使うと動作の確認がしやすかった<br>
以下が確認で使ったReplのログ<br>
ここのURLの箇所も展開されてしまうのでembed-githubのところはembed-github-dummyに置き換えている  </p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">python</span>
<span class="n">Python</span> <span class="mf">3.8.11</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Jul</span>  <span class="mi">3</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">08</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">01</span><span class="p">)</span> 
<span class="p">[</span><span class="n">Clang</span> <span class="mf">12.0.5</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1205.0.22.9</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;copyright&quot;</span><span class="p">,</span> <span class="s2">&quot;credits&quot;</span> <span class="ow">or</span> <span class="s2">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="o">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">markdown</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;[https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/serializers.py#L6-L16:embed-github-dummy]&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;plugins.embed_github&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">html</span>
<span class="s1">&#39;&lt;p&gt;</span><span class="se">\n</span><span class="s1">&lt;script src=&quot;https://emgithub.com/embed.js?target=%5Bhttps%3A//github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/serializers.py%23L6-L16%3Aembed-github%5D&amp;style=github&amp;showBorder=on&amp;showLineNumbers=on&amp;showFileMeta=on&amp;showCopy=on&quot;&gt;&lt;/script&gt;</span><span class="se">\n</span><span class="s1">&lt;/p&gt;&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">^</span><span class="n">D</span>
</code></pre></div>

<h3>リンク</h3>
<ul>
<li>Embed Like Gist <a href="https://emgithub.com">https://emgithub.com</a></li>
<li>Embedly Extension for Python-Markdown(mdx_embedly) <a href="https://github.com/yymm/mdx_embedly">https://github.com/yymm/mdx_embedly</a></li>
</ul>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Tags: <a href="https://nkm3.org/tag/note.html">note</a>, <a href="https://nkm3.org/tag/software.html">software</a>, </p>
                    </aside>
                    <hr/>
                </article>
            </li>
        </ol>
    </div>
        </div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1928342-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1928342-2');
</script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#000"
    },
    "button": {
      "background": "#ffffff"
    }
  },
  "theme": "edgeless",
  "position": "bottom-left"
});
</script>
        <script src="https://nkm3.org/theme/js/main.js"></script>
    </body>
</html>