<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nkm3</title>
    <link rel="shortcut icon" type="image/png" href="https://nkm3.org/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://nkm3.org/favicon.ico">
    <link href="https://nkm3.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="nkm3 Full Atom Feed" />
    <link rel="stylesheet" href="https://nkm3.org/theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://nkm3.org/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="sonkmr" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="selected"><a href="https://nkm3.org/">Home</a></li>
                <li><a href="/pages/about.html">About</a></li>
                <li><a href="/archives.html">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://nkm3.org/">nkm3</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">
            <div class="center">            <h4 class="date">2021/08/12</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://nkm3.org/flashcard-with-django-nuxtjs-vuetify-pt2.html" rel="bookmark" title="Permanent Link to &quot;Making Flashcard app with Django REST framework, nuxtjs and Vuetify. part2&quot;">Making Flashcard app with Django REST framework, nuxtjs and Vuetify. part2</a>
                </h2>

                
                

                <h2>これはなに</h2>
<ul>
<li>Django REST frameworkとnuxtjs、Vuetifyで作った単語カード風アプリ</li>
<li>nuxtjsとVuetifyを使ってみたくて作りはじめた</li>
<li>ソースコードのレポジトリ <a href="https://github.com/sonkm3/wordbook" rel="nofollow">https://github.com/sonkm3/wordbook</a></li>
</ul>
<h2>想定していた完成形</h2>
<ul>
<li>ユーザーは複数の単語帳を作れる</li>
<li>単語帳には単語を登録できる</li>
<li>単語のフィールドは単語と発音、ヒント、説明を登録できる</li>
<li>単語カード画面ではランダムに単語が表示される</li>
<li>単語カード画面には単語、発音、ヒントが表示され、裏返す的な操作をすると説明が見られる</li>
<li>メールアドレスでログインできる</li>
<li>認証は一旦Token認証で割り切る</li>
</ul>
<h2>実装内容</h2>
<p>実装内容は大きく2種類  </p>
<ul>
<li>リスト表示とそれぞれの項目のCRUD処理<ul>
<li>単語帳</li>
<li>単語のリスト表示とCRUD処理</li>
</ul>
</li>
<li>単語カード画面の表示</li>
</ul>
<h2>構成</h2>
<ul>
<li>
<p>バックエンド</p>
<ul>
<li>Django <a href="https://www.djangoproject.com" rel="nofollow">https://www.djangoproject.com</a></li>
<li>Django REST framework <a href="https://www.django-rest-framework.org" rel="nofollow">https://www.django-rest-framework.org</a></li>
<li>djoser <a href="https://github.com/sunscrapers/djoser" rel="nofollow">https://github.com/sunscrapers/djoser</a></li>
<li>Django Filter <a href="https://github.com/carltongibson/django-filter/tree/main" rel="nofollow">https://github.com/carltongibson/django-filter/tree/main</a></li>
<li>drf-nested-routers <a href="https://github.com/alanjds/drf-nested-routers" rel="nofollow">https://github.com/alanjds/drf-nested-routers</a></li>
<li>django-cors-headers <a href="https://github.com/adamchainz/django-cors-headers" rel="nofollow">https://github.com/adamchainz/django-cors-headers</a></li>
</ul>
</li>
<li>
<p>フロントエンド</p>
<ul>
<li>NuxtJS <a href="https://nuxtjs.org" rel="nofollow">https://nuxtjs.org</a></li>
<li>Vuetify <a href="https://vuetifyjs.com/en/" rel="nofollow">https://vuetifyjs.com/en/</a></li>
</ul>
</li>
</ul>
<h2>フロントエンドの概要</h2>
<ul>
<li>手が入っているのは主にpages以下のvueファイル</li>
<li>サインイン、トークン取得、サインアウトはnuxt/authを使っている <a href="https://auth.nuxtjs.org" rel="nofollow">https://auth.nuxtjs.org</a></li>
<li>httpクライアントはnuxt/axios <a href="https://axios.nuxtjs.org" rel="nofollow">https://axios.nuxtjs.org</a></li>
<li>ルーティングはnuxtjsのもの</li>
<li>リスト表示はData tablesのCRUDのサンプルをもとにして作った <a href="https://vuetifyjs.com/ja/components/data-tables/" rel="nofollow">https://vuetifyjs.com/ja/components/data-tables/</a></li>
</ul>
<h2>認証について</h2>
<h2>httpクライアント</h2>
<h2>ルーティングの設定</h2>
<ul>
<li>pagesのcourse以下はディレクトリ構造でルーティングを実現</li>
<li>バックエンドと同じく<code>/courses/1/words/</code>のようなパスを使いたい</li>
<li>
<p><code>dynamic nested routes</code>と呼ばれる仕組みを使って実装</p>
<p><a href="https://nuxtjs.org/docs/2.x/features/file-system-routing#dynamic-nested-routes" rel="nofollow">https://nuxtjs.org/docs/2.x/features/file-system-routing#dynamic-nested-routes</a></p>
</li>
</ul>
<p>ドキュメント上ではidのプレースホルダになっている箇所は<code>_id.vue</code>とファイルになっているがディレクトリ＋index.vueファイルの組み合わせでも期待通りのルーティングがされる<br>
上記<code>/courses/1/words/</code>は<code>/courses/1/words/index.vue</code>にルーティングされる</p>
<pre>
pages/
├── courses
│   ├── _course_id
│   │   └── words
│   │       ├── index.vue
│   │       └── practice.vue
│   └── index.vue
├── index.vue
├── inspire.vue
├── signin.vue
├── signout.vue
└── signup.vue
</pre>

<h2>リスト表示とCRUD処理</h2>
<h2>単語カード表示</h2>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://nkm3.org/flashcard-with-django-nuxtjs-vuetify-pt2.html">posted at 00:00</a>
                    &nbsp;&middot;&nbsp;<a href="https://nkm3.org/category/note.html" rel="tag">note</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://nkm3.org/tag/note.html" class="tags">note</a>
                    &nbsp;<a href="https://nkm3.org/tag/software.html" class="tags">software</a>
                </div>
            </article>            <h4 class="date">2021/08/11</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://nkm3.org/flashcard-with-django-nuxtjs-vuetify-pt1.html" rel="bookmark" title="Permanent Link to &quot;Making Flashcard app with Django REST framework, nuxtjs and Vuetify. part1&quot;">Making Flashcard app with Django REST framework, nuxtjs and Vuetify. part1</a>
                </h2>

                
                

                <h2>これはなに</h2>
<ul>
<li>Django REST frameworkとnuxtjs、Vuetifyで作った単語カード風アプリ</li>
<li>nuxtjsとVuetifyを使ってみたくて作りはじめた</li>
<li>ソースコードのレポジトリ <a href="https://github.com/sonkm3/wordbook" rel="nofollow">https://github.com/sonkm3/wordbook</a></li>
</ul>
<h2>想定していた完成形</h2>
<ul>
<li>ユーザーは複数の単語帳を作れる</li>
<li>単語帳には単語を登録できる</li>
<li>単語のフィールドは単語と発音、ヒント、説明を登録できる</li>
<li>単語カード画面ではランダムに単語が表示される</li>
<li>単語カード画面には単語、発音、ヒントが表示され、裏返す的な操作をすると説明が見られる</li>
<li>メールアドレスでログインできる</li>
<li>認証は一旦Token認証で割り切る</li>
</ul>
<h2>実装内容</h2>
<p>実装内容は大きく2種類  </p>
<ul>
<li>リスト表示とそれぞれの項目のCRUD処理<ul>
<li>単語帳</li>
<li>単語のリスト表示とCRUD処理</li>
</ul>
</li>
<li>単語カード画面の表示</li>
</ul>
<h2>構成</h2>
<ul>
<li>
<p>バックエンド</p>
<ul>
<li>Django <a href="https://www.djangoproject.com" rel="nofollow">https://www.djangoproject.com</a></li>
<li>Django REST framework <a href="https://www.django-rest-framework.org" rel="nofollow">https://www.django-rest-framework.org</a></li>
<li>djoser <a href="https://github.com/sunscrapers/djoser" rel="nofollow">https://github.com/sunscrapers/djoser</a></li>
<li>Django Filter <a href="https://github.com/carltongibson/django-filter/tree/main" rel="nofollow">https://github.com/carltongibson/django-filter/tree/main</a></li>
<li>drf-nested-routers <a href="https://github.com/alanjds/drf-nested-routers" rel="nofollow">https://github.com/alanjds/drf-nested-routers</a></li>
<li>django-cors-headers <a href="https://github.com/adamchainz/django-cors-headers" rel="nofollow">https://github.com/adamchainz/django-cors-headers</a></li>
</ul>
</li>
<li>
<p>フロントエンド</p>
<ul>
<li>NuxtJS <a href="https://nuxtjs.org" rel="nofollow">https://nuxtjs.org</a></li>
<li>Vuetify <a href="https://vuetifyjs.com/en/" rel="nofollow">https://vuetifyjs.com/en/</a></li>
</ul>
</li>
</ul>
<h2>バックエンドの実装</h2>
<h3>modelの実装</h3>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/models.py" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/models.py</a></p>
<ul>
<li><code>django REST framework</code>の<code>ModelViewSet</code>と<code>ModelSerializer</code>から使うためデフォルトのクエリセット以外に処理を書く必要がない</li>
<li><code>models.Manager</code>クラスを使うことでクエリに関わる実装を少なくする<ul>
<li>単語帳に紐づいた単語を取得するクエリセットを返すメソッドを<code>WordManager</code>クラスに用意し</li>
<li><code>viewWordViewSet</code>の<code>get_queryset</code>から<code>Word.objects.course()</code>と呼び出すとフィルタされたクエリセットが返ってくる</li>
<li>このクエリセットにページネーションやソートのクエリが加わっていく</li>
</ul>
</li>
</ul>
<h3>serializerの実装</h3>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/serializers.py" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/serializers.py</a></p>
<ul>
<li><code>django REST framework</code>の<code>ModelViewSet</code>から使う想定</li>
<li><code>serializers.ModelSerializer</code>を使うので書き足した箇所はバリデーションぐらい</li>
<li>単語帳の持ち主とユーザーが一致するかのバリデーションはSerializerのバリデーションでおこなっている<ul>
<li>例えば<code>validate_courseメソッド</code>でおこなえ、<code>course</code>フィールドは<code>_course</code>のようにすることで指定できる</li>
</ul>
</li>
</ul>
<h3>viewの実装</h3>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/views.py" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/views.py</a></p>
<ul>
<li><code>django REST framework</code>の<code>ModelViewSet</code>を使っているのであまり書かなくてよいが<code>drf-nested-routers</code>に関わる実装は必要</li>
<li><code>drf-nested-routers</code>に関わる実装について<ul>
<li><code>courses/{course_id}/words/</code>というパスにしたかったので<code>drf-nested-routers</code>を導入した</li>
<li>この場合<code>course_id</code>は<code>self.kwargs["course_pk"]</code>としてviewにわたってくる</li>
<li><code>request.data</code>には入っていないので<code>create</code>メソッドをオーバーライドして<code>request.data</code>に<code>course_pk</code>を追加している</li>
</ul>
</li>
<li><code>pagination</code>について<ul>
<li>フロントエンドの作りに合わせて<code>PageNumberPagination</code>をもとにした<code>CustomPagination</code>を作った</li>
</ul>
</li>
</ul>
<h3>ルーティング</h3>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/wordbook/urls.py" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/wordbook/urls.py</a></p>
<ul>
<li><code>NestedSimpleRouter</code>を使って<code>courses/{course_id}/words/</code>を実現している</li>
</ul>
<h3>emailでのログインについて</h3>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/models.py#L9-L51" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/app/models.py#L9-L51</a></p>
<ul>
<li><code>CustomUser</code>と<code>CustomUserManager</code>を作って対応</li>
<li><code>create_user</code>に関わる処理の変更を<code>CustomUserManager</code>でオーバーライドする</li>
<li><code>AbstractUser</code>を継承しているので<code>username</code>の条件は<code>CustomUser</code>でオーバーライドできる</li>
<li>CustomUserはAbstractModelを継承しているのでfirst/last_nameなどの使わないフィールドは<code>Null</code>を代入することで削除できる</li>
</ul>
<p><a href="https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/wordbook/settings.py" rel="nofollow">https://github.com/sonkm3/wordbook/blob/main/wordbook-backend/wordbook/settings.py</a></p>
<ul>
<li>CustomUserクラスとemailフィールドをログイン時に使うようにする変更は<code>settings.py</code>でおこなう<ul>
<li><code>AUTH_USER_MODEL</code>を上で定義した<code>CustomUser</code>に設定(Djangoが使うユーザーモデルを変更する設定)</li>
<li><code>DJOSER</code>の<code>LOGIN_FIELD</code>を<code>email</code>に設定(djoserのユーザー名フィールドを変更する設定)</li>
</ul>
</li>
</ul>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://nkm3.org/flashcard-with-django-nuxtjs-vuetify-pt1.html">posted at 00:00</a>
                    &nbsp;&middot;&nbsp;<a href="https://nkm3.org/category/note.html" rel="tag">note</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://nkm3.org/tag/note.html" class="tags">note</a>
                    &nbsp;<a href="https://nkm3.org/tag/software.html" class="tags">software</a>
                </div>
            </article>
            </div>
            <div class="sidebar_right">
<h2 class="title">about</h2>


<ul>
    <li>なにか</li>
    <li>かきます</li>
</ul>
            </div>
        </div>
        <div class="clear"></div>
        <footer>
            </p>
            <small>&copy; 2021 sonkmr</small>
        </footer>

        <div class="clear"></div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#EEF7FB",
      "text": "#5c7291"
    },
    "button": {
      "background": "#4EA6D6",
      "text": "#ffffff"
    }
  },
  "theme": "edgeless",
  "content": {
    "href": "/pages/about.html#privacypolicy"
  }
});
</script></body>
</html>